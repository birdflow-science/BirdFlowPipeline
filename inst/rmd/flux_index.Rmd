---
title: "Flux Index"
output: html_document
params:
  index: ""
---

```{r setup, include=FALSE, echo = FALSE}
knitr::opts_chunk$set(echo = FALSE)

index <- params$index

# Allow knitting with test data while developing/debugging 
if (!is.data.frame(index)) {
  index <- readRDS(system.file("rmd/flux_index_example.Rds",
                               package = "BirdFlowPipeline"))
}

required_cols <- c("species", "common_name", "scientific", 
                   "report_exists", "rel_link")
stopifnot(all(required_cols %in% names(index)))

used_cols <- c("species", "report_exists")

# Add links to ebird species information e.g.:
# https://science.ebird.org/en/status-and-trends/species
#    /amewoo/abundance-map-weekly?week=1
index$species <-
  paste0("[", index$species,
         "](https://science.ebird.org/en/status-and-trends/species/",
         index$species, "/abundance-map-weekly?week=1)")

sv <- index$report_exists
index$common_name[sv] <- paste0("[", index$common_name[sv], "](./",
                          index$rel_link[sv], ")")



# List names are column names values are what we want to display them as
# order here will be used
displayed_columns <-  c(`Common name` = "common_name",
                        `Scientific name` = "scientific",
                        `eBird S&T code` = "species")
                    
# Rename and reorder to match above
index <- dplyr::rename(index, all_of(displayed_columns))
index <- index[, names(displayed_columns), drop = FALSE]

logo_url <- "https://birdflow-science.github.io/BirdFlowR/logo.png"

```

<a href="https://birdflow-science.github.io/BirdFlowR/"><img src="`r logo_url`" align="right" height="139" /></a>

<br><br><br>
   
----

The table below links to flux animations for most migratory bird
species in North America.  

Flux is built from [BirdFlow](https://birdflow-science.github.io) models 
which are in turn trained on 
[eBird Status and Trends (S&T)](https://science.ebird.org/en/status-and-trends) 
weekly distributions.  
[Details on flux calculations](https://birdflow-science.github.io/BirdFlowR/reference/calc_flux.html) are available in the documentation.

All results are preliminary and should not be considered final or 
publication ready. There has been little to no QC.


**Common Name** links to the flux animation.
**eBird S&T code** links to eBird species information.  

----


```{r table}
knitr::kable(index)
```



```{r footer, child = system.file("rmd/footer.Rmd", package = "BirdFlowPipeline")}
## Note footer document is taken from the installed package 
## devtools::load_all() is NOT sufficient to update it
```



