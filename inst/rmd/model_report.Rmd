---
title: "BirdFlow model summary for `r bf$species$common_name`"
subtitle: "`r sub('\\.hdf5$', '', ll_df$model[1])`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Preprocessing info

- eBird Status and Trends version: `r bf$metadata$ebird_version_year`
- grid resolution: `r params$my_res` km

Hyperparameters

```{r hyperparameters, echo = FALSE}
kableExtra::kbl(
  ll_df[1, c('de_ratio', 'obs_prop', 'dist_pow', 'dist_weight', 'ent_weight', 'obs_weight')]
  )
```

Model selection crtieria

- evaluation season: `r params$season`
- desirability method: `r params$model_selection`

Correlation and calibration

```{r cor_cal, echo = FALSE}
kableExtra::kbl(
  ll_df[1, c('end_traverse_cor', 'pit_row', 'pit_col', 'pit_in_95')]
  )
```

Desirability

```{r desirability, echo = FALSE}
kableExtra::kbl(
    ll_df[1, c('d_pit_row', 'd_pit_col', 'd_pit_in_95', 'pit_d', 'etc_d', 'str_d', 'nso_d', 'overall_des'), drop = FALSE]
)
```

Simulated route map (n = 10)

```{r route_map, echo = FALSE, message = FALSE}
rts <- BirdFlowR::route(bf = bf, n = 10, season = params$season, from_marginals = TRUE)
  print(
    BirdFlowR::plot_routes(rts, bf, use_seasonal_colors = FALSE)
  )
```

Simulated route stats (n = 100)

```{r route_stats, echo = FALSE, message = FALSE}
kableExtra::kbl(
  ll_df[1, c('straightness', 'length', 'displacement', 'n_stopovers')]
  )
```

Real tracking route stats

```{r real_route_stats, echo = FALSE, message = FALSE}
kableExtra::kbl(
  as.data.frame(
    readRDS(
      file.path(
        params$output_path,
        'real_track_stats.rds'
      )
    )
  )
)
```

